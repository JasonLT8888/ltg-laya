!function(){function e(){this.request=[],this.push=function(e){this.request.length>=18?(this.request.shift(),this.request.push(e)):this.request.push(e)},this.concat=function(){this.request.map(function(e){qq.Queue.push(e)}),this.request=[]}}function t(){var e="";try{e=qq.getStorageSync("aldstat_op")}catch(t){e=qq.getStorageSync("aldstat_op")}if(""===e){if(""===_)return"";try{O=e=qq.getStorageSync(_),e&&qq.setStorageSync("aldstat_op",e)}catch(t){O=e=qq.getStorageSync(_),e&&qq.setStorageSync("aldstat_op",e)}}return e}function n(){function e(e){return!/^\d+(.\d+)*$/.test(e.stageId)||e.stageId.length>32?(console.warn("关卡stageId必须符合传参规则,请参考文档。"),!1):!("string"!==i(e.stageName)||e.stageName.length>32)||(console.warn("关卡名称为必传字段,且长度小于32个字符,请参考文档"),!1)}var t="",n="",r=0;this.onStart=function(a){if(e(a)){var s={};r=Date.now(),s.sid=a.stageId,s.snm=a.stageName,s.state="start",n=c(),t=s,("string"===i(a.userId)&&a.userId)<32&&(this.uid=a.uid),this.request()}},this.onRunning=function(n){if(e(n)){var r={params:{}};if(("string"===i(n.userId)&&n.userId)<32&&(this.uid=n.uid),Q.join(",").indexOf(n.event+","),"string"!==i(n.event)||Q.join(",").indexOf(n.event+",")===-1)return void console.warn("关卡running状态中仅支持"+Q.join(",")+"事件类型，且为必传字段，详情请参考文档。");if(r.event=n.event,"object"!==i(n.params))return void console.warn("关卡running状态中params为必传字段，且该字段需为Object类型，详情请参考文档。");if("string"!==i(n.params.itemName)||n.params.itemName.length>32)return void console.warn("道具/商品名称为必传字段，且长度小于32个字符，详情请参考文档");r.params.itnm=n.params.itemName,"string"===i(n.params.itemId)&&n.params.itemId.length<32&&(r.params.itid=n.params.itemId),"number"===i(n.params.itemCount)&&n.params.itemCount.length<32?r.params.itco=n.params.itemCount:r.params.itco=1,n.event.indexOf("pay")!==-1&&("number"===i(n.params.itemMoney)&&n.params.itemMoney.length<32?r.params.money=n.params.itemMoney:r.params.money=0),"string"===i(n.params.desc)&&n.params.desc.length<64&&(r.params.desc=n.params.desc),r.state="running",r.sid=n.stageId,r.snm=n.stageName,t=r,this.request()}},this.onEnd=function(n){if(e(n)){var a={};if(a.state="end",("string"===i(n.userId)&&n.userId)<32&&(this.uid=n.uid),!i(n.event)&&U.join(",").indexOf(n.event+",")!==-1)return void U.join(",");a.sid=n.stageId,a.snm=n.stageName,a.event=n.event,a.sdr=0!==r?Date.now()-r:"",a.params={},"object"===i(n.params)&&"string"===i(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),t=a,this.request()}},this.request=function(){var e=h(b);t.ss=n,e.ct=t,f(e,"screen")}}function r(){return new Promise(function(e,t){qq.getSetting({success:function(t){t.authSetting["scope.userInfo"]?qq.getUserInfo({success:function(t){P=q(t.userInfo.avatarUrl.split("/")),e(t)},fail:function(){e("")}}):e("")},fail:function(){e("")}})})}function a(){return new Promise(function(e,t){qq.getNetworkType({success:function(t){e(t)},fail:function(){e("")}})})}function s(){return new Promise(function(e,t){"1044"==M.scene?qq.getShareInfo({shareTicket:M.shareTicket,success:function(t){e(t)},fail:function(){e("")}}):e("")})}function o(){return new Promise(function(e,t){y.getLocation?qq.getLocation({success:function(t){e(t)},fail:function(){e("")}}):qq.getSetting({success:function(t){t.authSetting["scope.userLocation"]?(qq.getLocation({success:function(t){e(t)},fail:function(){e("")}}),e("")):e("")},fail:function(){e("")}})})}function i(e){function t(e){return Object.prototype.toString.call(e)}var n={};return"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e,t){n["[object "+e+"]"]=e.toLowerCase()}),function(){return null==e?e:"object"==typeof e||"function"==typeof e?n[t.call(e)]||"object":typeof e}()}function u(e){for(var t in e)if("object"==typeof e[t]&&null!==e[t])return!0;return!1}function c(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}function d(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var e=this;this.push=function(t){this.tasks.push(new Promise(function(n,r){var a=function(){e.activeCount++,t().then(function(e){n(e)}).then(function(){e.next()})};e.activeCount<e.concurrency?a():e.queue.push(a)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){e.activeCount--,e.queue.length>0&&e.queue.shift()()}}function f(e,n){function r(){return new Promise(function(t,n){qq.request({url:"https://"+p+".aldwx.com/d.html",data:e,header:{se:I||"",op:O||"",img:P||""},method:"GET",fail:function(){t("")},success:function(e){t(200==e.statusCode?"":"status error")}})})}y.useOpen&&t(),j++,e.as=D,e.at=N,e.rq_c=j,e.ifo=S,e.ak=y.app_key,e.uu=w,e.v=g,e.st=Date.now(),e.ev=n,e.wsr=JSON.stringify(M),e.te=v,""!==l(e.ufo)&&(e.ufo=e.ufo),e.ec=k,y.useOpen?""===O?J.push(r):(qq.Queue.push(r),J.concat()):qq.Queue.push(r)}function l(e){if(void 0===e||""===e)return"";var t={};for(var n in e)"rawData"!=n&&"errMsg"!=n&&(t[n]=e[n]);return t}function h(e){var t={};for(var n in e)t[n]=e[n];return t}function q(e){for(var t="",n=0;n<e.length;n++)e[n].length>t.length&&(t=e[n]);return t}var g="2.0.0",p="qg.log",v="qg",m={};!function(){qq,v="qg",m=wx=qq}();var y=require("./ald-game-conf");""===y.app_key&&console.error("请在配置文件中填写您的app_key"),y.useOpen&&console.warn("提示：开启了useOpen配置后，如果不上传用户opendId则不会上报数据。"),y.app_key=y.app_key.replace(/\s/g,"");var _=y.openKey;!function(){qq.request({url:"https://"+p+".aldwx.com/config/app.json",method:"GET",success:function(e){200===e.statusCode&&(e.data.version!=g&&console.warn("您的SDK不是最新版本，请尽快升级！"),e.data.warn&&console.warn(e.data.warn),e.data.error&&console.error(e.data.error))}})}();var S="",w=function(){var e="";try{e=qq.getStorageSync("aldstat_uuid"),qq.setStorageSync("ald_ifo",!0)}catch(t){e="uuid_getstoragesync"}if(e)S=!1;else{e=c(),S=!0;try{qq.setStorageSync("aldstat_uuid",e)}catch(e){qq.setStorageSync("aldstat_uuid","uuid_getstoragesync")}}return e}(),b={},I="",O=t(),k=0,j="",M=qq.getLaunchOptionsSync(),x=Date.now(),N=""+Date.now()+Math.floor(1e7*Math.random()),D=""+Date.now()+Math.floor(1e7*Math.random()),C=0,E="",P="",L=!0,A=!1,T=["aldSendEvent","aldOnShareAppMessage","aldShareAppMessage","aldSendSession","aldSendOpenid","aldLevelEvent"],Q=["payStart","paySuccess","payFail","die","revive","tools","award"],U=["complete","fail"];void 0===qq.Queue&&(qq.Queue=new d,qq.Queue.all());var J=new e;(function(){return Promise.all([r(),a(),o()])})().then(function(e){""!==e[2]?(b.lat=e[2].latitude||"",b.lng=e[2].longitude||"",b.spd=e[2].speed||""):(b.lat="",b.lng="",b.spd=""),""!==e[1]?b.nt=e[1].networkType||"":b.nt="";var t=h(b);""!==e[0]&&(t.ufo=e[0],E=e[0]),f(t,"init")}),qq.onShow(function(e){if(M=e,M.scene,e.scene,C=Date.now(),!L&&!A){N=""+Date.now()+Math.floor(1e7*Math.random()),S=!1;try{qq.setStorageSync("ald_ifo",!1)}catch(e){}}L=!1,A=!1;var t=h(b),n=h(b);t.sm=C-x,void 0!==e.query&&void 0!==e.query.ald_share_src&&e.shareTicket&&"1044"===e.scene?(n.tp="ald_share_click",s().then(function(e){n.ct=e,f(n,"event")})):void 0!==e.query&&void 0!==e.query.ald_share_src&&(n.tp="ald_share_click",n.ct="1",f(n,"event")),""===E&&qq.getSetting({success:function(e){e.authSetting["scope.userInfo"]&&qq.getUserInfo({success:function(e){var t=h(b);t.ufo=JSON.stringify(e),E=e,P=q(e.userInfo.avatarUrl.split("/")),f(t,"ald_ufo")}})}}),f(t,"show")}),qq.onHide(function(){var e=h(b);e.dr=Date.now()-C,f(e,"hide")}),qq.onError(function(e){var t=h(b);t.tp="ald_error_message",t.ct=e,k++,f(t,"event")});var H={aldSendEvent:function(e,t){var n=h(b);if(""!==e&&"string"==typeof e&&e.length<=255)if(n.tp=e,"string"==typeof t&&t.length<=255)n.ct=String(t),f(n,"event");else if("object"==typeof t){if(JSON.stringify(t).length>=255)return void console.error("自定义事件参数不能超过255个字符");if(u(t))return void console.error("事件参数，参数内部只支持Number,String等类型，请参考接入文档");for(var r in t)"number"==typeof t[r]&&(t[r]=t[r]+"s##");n.ct=JSON.stringify(t),f(n,"event")}else void 0===t||""===t?f(n,"event"):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符");else console.error("事件名称必须为String类型且不能超过255个字符")},aldOnShareAppMessage:function(e){qq.onShareAppMessage(function(){A=!0;var t=e(),n="";n=void 0!==M.query&&void 0!==M.query.ald_share_src?void 0!==t.query?(M.query.ald_share_src.indexOf(w),t.query+"&ald_share_src="+M.query.ald_share_src+","+w):(M.query.ald_share_src.indexOf(w),"ald_share_src="+M.query.ald_share_src+","+w):void 0!==t.query?t.query+"&ald_share_src="+w:"ald_share_src="+w,"undefined"!=i(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n;var r=h(b);return r.ct=t,r.ct.sho=1,r.tp="ald_share_chain",f(r,"event"),t})},aldShareAppMessage:function(e){A=!0;var t=e,n="";n=void 0!==M.query&&void 0!==M.query.ald_share_src?void 0!==t.query?(M.query.ald_share_src.indexOf(w),t.query+"&ald_share_src="+M.query.ald_share_src+","+w):(M.query.ald_share_src.indexOf(w),"ald_share_src="+M.query.ald_share_src+","+w):void 0!==t.query?t.query+"&ald_share_src="+w:"ald_share_src="+w;var r=h(b);"undefined"!=i(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n,r.ct=t,r.tp="ald_share_chain",f(r,"event"),qq.shareAppMessage(t)},aldSendSession:function(e){if(""===e||!e)return void console.error("请传入从后台获取的session_key");var t=h(b);t.tp="session",t.ct="session",I=e,""===E?qq.getSetting({success:function(e){e.authSetting["scope.userInfo"]?qq.getUserInfo({success:function(e){t.ufo=e,f(t,"event")}}):f(t,"event")}}):(t.ufo=E,""!==E&&(t.gid=""),f(t,"event"))},aldSendOpenid:function(e){if(!e||28!=e.length&&32!=e.length)return void console.error("openID不符合规则");O=e,qq.setStorageSync("aldstat_op",e);var t=h(b);t.tp="openid",t.ct="openid",f(t,"event")}};qq.aldStage=new n;for(var K=0;K<T.length;K++)!function(e,t){Object.defineProperty(qq,e,{value:t,writable:!1,enumerable:!0,configurable:!0})}(T[K],H[T[K]]);try{var R=qq.getSystemInfoSync();b.br=R.brand||"",b.md=R.model,b.pr=R.pixelRatio,b.sw=R.screenWidth,b.sh=R.screenHeight,b.ww=R.windowWidth,b.wh=R.windowHeight,b.lang=R.language,b.wv=R.version,b.sv=R.system,b.wvv=R.platform,b.fs=R.fontSizeSetting,b.wsdk=R.SDKVersion,b.bh=R.benchmarkLevel||"",b.bt=R.battery||"",b.wf=R.wifiSignal||"",b.lng="",b.lat="",b.nt="",b.spd="",b.ufo=""}catch(e){}}();